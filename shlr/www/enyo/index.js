enyo.kind({name:"About",kind:"Scroller",style:"background-color:#303030",components:[{tag:"center",components:[{tag:"h1",style:"color:#f0f0f0",content:"r2wui"},{kind:"Image",src:"icon.png"},{tag:"h3",style:"color:#707070;margin-bottom:50px",content:"the web frontend for radare2"},{tag:"h2",style:"color:#a0a0a0",content:"author: pancake 2013"},{tag:"h2",style:"color:#a0a0a0",content:"version: 0.9.5git3",name:"version"}]}],create:function(){this.inherited(arguments);r2.cmd("?V",function(version){this.$.version.setContent("version: "+version)})}});enyo.kind({name:"Assembler",kind:"Scroller",classes:"r2panel",components:[{tag:"form",style:"margin-top:8px;margin-left:8px",attributes:{action:"javascript:#"},components:[{kind:"FittableRows",fit:true,components:[{kind:"onyx.InputDecorator",classes:"r2ui-input",components:[{tag:"font",content:"opcode",classes:"r2ui-input",style:"width:64px;font-weight:bold"},{kind:"Input",value:"",style:"width:60%",onkeydown:"assembleOpcode",attributes:{autocapitalize:"off"},name:"opcode"}]},{kind:"onyx.InputDecorator",classes:"r2ui-input",components:[{tag:"font",content:"bytes",classes:"r2ui-input",style:"width:64px;font-weight:bold"},{kind:"Input",value:"",style:"width:120px",onkeydown:"assembleOpcode",attributes:{autocapitalize:"off"},name:"bytes"}]},{kind:"onyx.InputDecorator",classes:"r2ui-input",components:[{tag:"font",content:"offset",classes:"r2ui-input",style:"width:64px;font-weight:bold"},{kind:"Input",value:"entry0",style:"width:120px",onkeydown:"assembleOpcode",attributes:{autocapitalize:"off"},name:"offset"}]}]}]},{tag:"form",style:"margin-top:8px;margin-left:8px",attributes:{action:"javascript:#"},components:[{tag:"h2",content:"Calculator"},{kind:"onyx.InputDecorator",classes:"r2ui-input",components:[{tag:"font",name:"value",content:"0",classes:"r2ui-input",style:"width:200px;font-weight:bold"},{kind:"Input",name:"ivalue",value:"0",style:"width:300",onkeydown:"calculateValue",attributes:{autocapitalize:"off"}}]}]}],calculateValue:function(inSender,inEvent){if(inEvent.keyCode===13){var v=this.$.value;var val=inSender.getValue();v.setContent("...");r2.cmd("?v "+val,function(x){v.setContent(x)})}},assembleOpcode:function(inSender,inEvent){if(inEvent.keyCode===13){var arg=inSender.getValue();var off=this.$.offset.getValue();switch(inSender.name){case"opcode":var hex=this.$.bytes;r2.assemble(off,arg,function(bytes){hex.setValue(bytes)});break;case"bytes":var op=this.$.opcode;r2.disassemble(off,arg,function(x){op.setValue(x)});break;case"offset":break}}}});var Config={keys:{1:"this.setIndex(0)",2:"this.setIndex(1)",3:"this.setIndex(2)",d:"r2ui.openpage(0)",a:"r2ui.openpage(1)",h:"r2ui.openpage(2)",g:"r2ui.openpage(3)",c:"r2ui.openpage(5)",s:"r2ui.openpage(8)",";":"r2.cmd('CC '+prompt('comment'));r2ui.seek('$$',true);"}};enyo.kind({name:"Console",kind:"Scroller",classes:"r2panel",style:"padding-left:7px",components:[{tag:"form",attributes:{action:"javascript:#"},components:[{kind:"FittableRows",fit:true,classes:"fittable-sample-shadow",components:[{kind:"onyx.InputDecorator",style:"margin-top:8px;background-color:#404040;width: 90%;display:inline-block",components:[{kind:"Input",style:"width:100%;color:white",value:"",onkeydown:"runCommand",attributes:{autocapitalize:"off"},name:"input"}]},{tag:"pre",classes:"r2ui-terminal",style:"width:90%;",fit:true,allowHtml:true,name:"output"}]}]}],runCommand:function(inSender,inEvent){if(inEvent.keyCode===13){var cmd=this.$.input.getValue();this.$.input.setValue("");(function(out){r2.cmd(cmd,function(x){out.setContent(x)})})(this.$.output)}}});function docss(x){return"<font color=black>"+x+"</font>"}enyo.kind({name:"Disassembler",kind:"Scroller",tag:"div",style:"margin:0px;background-color:#c0c0c0",data:null,components:[{tag:"div",allowHtml:true,classes:"colorbar",name:"colorbar"},{tag:"br"},{tag:"div",content:"^",classes:"moreless",ontap:"less"},{tag:"pre",allowHtml:true,name:"text",content:"..",style:"margin-left:5px"},{tag:"div",content:"v",classes:"moreless",ontap:"more"}],min:0,max:0,block:512,base:"entry0",less:function(){var self=this;var text=this.$.text;this.min+=this.block;r2.get_disasm(this.base+"-"+this.min,this.block,function(x){x=docss(r2.filter_asm(x,"pd"));var oldy=r2ui._dis.getScrollBounds().height;text.setContent(x+text.getContent());var newy=r2ui._dis.getScrollBounds().height;r2ui._dis.scrollTo(0,newy-oldy)})},more:function(){var text=this.$.text;this.max+=this.block;r2.get_disasm(this.base+"+"+this.max,this.block,function(x){x=docss(r2.filter_asm(x,"pd"));text.setContent(text.getContent()+x)})},seek:function(addr){var text=this.$.text;this.base=addr;this.min=this.max=0;r2.get_disasm(addr,this.block,function(x){x=docss(r2.filter_asm(x,"pd"));text.setContent(x)});this.colorbar_create()},create:function(){this.inherited(arguments);var text=this.$.text;this.seek("entry0");r2ui._dis=this;r2ui.history_push("entry0");this.colorbar_create()},colorbar_create:function(){var self=this;r2.cmd("pvj 24",function(x){try{var y=JSON.parse(x)}catch(e){alert(e);return}console.log(y);var c="<table class='colorbar'>"+"<tr valign=top style='height:8px;border-spacing:0'>";var colors={flags:"#c0c0c0",comments:"yellow",functions:"#5050f0",strings:"orange"};var off="";var WIDTH="100%";var HEIGHT=16;for(var i=0;i<y.blocks.length;i++){var block=y.blocks[i];var r="<div style='overflow:hidden;width:12px;'>____</div>";if(block.offset){var r="<table width='width:100%' height="+HEIGHT+" style='border-spacing:0px'>";var count=0;for(var k in colors)if(block[k])count++;count++;if(count==1)break;var h=HEIGHT/count;for(var k in colors){var color=colors[k];if(block[k])r+="<tr><td class='colorbar_item' style='background-color:"+colors[k]+"'><div style='width:12px;overflow:"+"hidden;height:"+h+"px'>____</div></td></tr>"}r+="</table>";off="0x"+block.offset.toString(16)}else{off="0x"+(y.from+y.blocksize*i).toString(16)}c+="<td onclick='r2ui.seek("+off+",true)' title='"+off+"' style='height:"+HEIGHT+"px' "+"width=15px>"+r+"</td>"}c+="</tr></table>";self.$.colorbar.setContent(c)})}});enyo.kind({name:"Graph",kind:"Scroller",style:"background-color:#c0c0c0",components:[{tag:"h2",content:"Open graph",style:"margin-left:10px;"},{kind:"Group",classes:"enyo-border-box group",defaultKind:"onyx.Button",components:[{content:"Basic blocks",classes:"onyx-dark menu-button",ontap:"openGraphBB"},{content:"Callgraph",classes:"onyx-dark menu-button",ontap:"openGraphCG"}]}],openGraphBB:function(){window.open("/graph/","_self")},openGraphCG:function(){window.open("/d3/","_self")}});function docss(x){return"<font color=black>"+x+"</font>"}enyo.kind({name:"Hexdump",kind:"Scroller",tag:"div",style:"margin:0px;background-color:#c0c0c0;color:black",data:null,components:[{tag:"div",allowHtml:true,classes:"colorbar",name:"colorbar"},{tag:"div",content:"^",classes:"moreless",ontap:"less"},{tag:"pre",allowHtml:true,name:"text",content:"..",style:"margin-left:5px;color:black"},{tag:"div",content:"v",classes:"moreless",ontap:"more"}],min:0,max:0,block:1024,base:"entry0",less:function(){var self=this;var text=this.$.text;this.min+=this.block;r2.get_hexdump(this.base+"-"+this.min,this.block,function(x){x=css(r2.filter_asm(x,"px"));var oldy=r2ui._hex.getScrollBounds().height;text.setContent(x+text.getContent());var newy=r2ui._hex.getScrollBounds().height;r2ui._hex.scrollTo(0,newy-oldy)})},more:function(){var text=this.$.text;this.max+=this.block;r2.get_hexdump(this.base+"+"+this.max,this.block,function(x){x=docss(r2.filter_asm(x,"px"));text.setContent(text.getContent()+x)})},seek:function(addr){var text=this.$.text;this.base=addr;this.min=this.max=0;r2.get_hexdump(addr,this.block,function(x){x=docss(r2.filter_asm(x,"px"));text.setContent(x)});this.colorbar_create()},create:function(){this.inherited(arguments);var text=this.$.text;this.seek("entry0");r2ui._hex=this;r2ui.history_push("entry0");this.colorbar_create()},setupItem:function(inSender,inIndex){this.$.msg.setContent(this.data[inIndex.index]);return true},colorbar_create:function(){var self=this;r2.cmd("pvj",function(x){try{var y=JSON.parse(x)}catch(e){alert(e);return}console.log(y);var c="<table class='colorbar'><tr valign=top style='height:20px;border-spacing:0'>";var colors={flags:"#c0c0c0",comments:"yellow",functions:"#5050f0",strings:"orange"};var off="";var WIDTH=10;var HEIGHT=30;for(var i=0;i<y.blocks.length;i++){var block=y.blocks[i];var r="<div style='overflow:hidden;background-color:#404040;width:"+WIDTH+"px;'>&nbsp;</div>";if(block.offset){var r="<table height="+HEIGHT+" style='color:black;border-spacing:0px'>";var count=0;for(var k in colors){if(block[k])count++}count++;if(count==1)break;var h=HEIGHT/count;for(var k in colors){var color=colors[k];if(block[k])r+="<tr><td style='width:"+WIDTH+"px;background-color:"+colors[k]+"'><div style='width:"+WIDTH+"px;overflow:"+"hidden;height:"+h+"px'>&nbsp;</div></td></tr>"}r+="</table>";off="0x"+block.offset.toString(16)}else{off="0x"+(y.from+y.blocksize*i).toString(16)}c+="<td onclick='r2ui.seek("+off+",true)' title='"+off+"' style='height:"+HEIGHT+"px' "+"width=15px>"+r+"</td>"}c+="</tr></table>";self.$.colorbar.setContent(c)})}});enyo.kind({name:"LeftPanel",classes:"onyx-toolbar",kind:"Scroller",fit:true,style:"width: 220px;height:100%;margin:0px;",accelerated:true,horizontal:"hidden",create:function(){this.inherited(arguments);this.$.strategy.setTranslateOptimized=true},components:[{tag:"center",components:[{tag:"h3",ontap:"openPanel2",content:"radare2",style:"margin:0px;margin-bottom:20px;"},{kind:"Group",onActivate:"buttonActivated",classes:"enyo-border-box group",defaultKind:"onyx.Button",highlander:true,components:[{content:"Disassembler",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Disassembler",active:true},{content:"Assembler",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Assembler"},{content:"Hexdump",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Hexdump"},{content:"Graph",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Graph"},{content:"Search",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Search"},{content:"Console",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Console"},{content:"Logs",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Logs"},{content:"Script",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Script"},{content:"Settings",classes:"onyx-dark menu-button",ontap:"openPanel",name:"Settings"},{content:"About",classes:"onyx-dark menu-button",ontap:"openPanel",name:"About"}]}]}],openPanel2:function(){this.ra.setIndex(2)},openPanel:function(x){if(enyo.Panels.isScreenNarrow())this.ra.setIndex(1);if(x.name==this.oname)this.ra.setIndex(1);this.oname=x.name;if(this.openCallback)this.openCallback(x.name)},oname:null,ra:null,oldSender:null,rowTap:function(inSender,inIndex){if(this.oldSender)this.oldSender.setStyle("width:100%");inSender.setStyle("background-color: #202020;width:100%");this.oldSender=inSender;if(this.openCallback)this.openCallback(inIndex.index)},openCallback:undefined,data:[],iter:1,refresh:function(){this.iter++}});enyo.kind({name:"Logs",kind:"Scroller",style:"background-color:#c0c0c0;padding-left:8px",components:[{tag:"form",attributes:{action:"javascript:#"},components:[{kind:"FittableRows",fit:true,classes:"fittable-sample-shadow",components:[{kind:"onyx.InputDecorator",style:"margin-top:8px;background-color:#404040;width: 90%;display:inline-block",components:[{kind:"Input",style:"width:100%;color:white",value:"",onkeydown:"sendMessage",attributes:{autocapitalize:"off"},name:"input"}]},{tag:"pre",classes:"r2ui-terminal",style:"width:90%;",fit:true,allowHtml:true,name:"output"}]}]}],logger:null,create:function(){this.inherited(arguments);var out=this.$.output;this.logger=r2.get_logger().on("message",function(msg){out.setContent(out.getContent()+msg.text+"\n")});this.logger.autorefresh(3)},sendMessage:function(inSender,inEvent){if(inEvent.keyCode===13){var msg=this.$.input.getValue();this.$.input.setValue("");this.logger.send(msg)}}});enyo.kind({name:"RadareApp",kind:"Panels",classes:"panels enyo-unselectable",realtimeFit:true,arrangerKind:"CollapsingArranger",components:[{name:"lp",kind:"LeftPanel"},{name:"mp",kind:"MainPanel"},{name:"rp",kind:"RightPanel"},{kind:enyo.Signals,onkeypress:"handleKeyPress"}],setPanel0:function(){this.$.RadareApp.setIndex(1)},create:function(){this.inherited(arguments);var data=[{name:"Disassembler",active:true},{name:"Assembler"},{name:"Hexdump"},{name:"Search"},{name:"Console"},{name:"Logs"},{name:"Script"},{name:"Settings",separator:true},{name:"About"}];this.$.lp.data=data;this.$.mp.data=data;r2ui.ra=this.$.mp.ra=this.$.lp.ra=this.$.rp.ra=this;var mp=this.$.mp;r2ui.mp=mp;this.$.lp.openCallback=function(idx){mp.openPage(idx)};this.$.lp.refresh()},handleKeyPress:function(inSender,inEvent){for(var key in Config.keys){if(key.substring(0,2)=="C-"){if(inEvent.ctrlKey){var k=key.substring(2).charCodeAt(0);if(inEvent.charCode==k){var cmd=Config.keys[key];eval(cmd+";")}}}else{var k=key.charCodeAt(0);if(inEvent.charCode==k){var cmd=Config.keys[key];eval(cmd+";")}}}}});window.onload=function(){var obj=(new RadareApp).renderInto(document.body)};enyo.kind({name:"MainPanel",classes:"onyx",kind:"FittableRows",classes:"enyo-fit",style:"margin:0px;padding:0px;border:0px",data:null,buttonClicked:function(x){alert("let's play!")},cancelClicked:function(x){alert("nothing to see here! move along.")},inputKey:function(inSender,inEvent){if(inEvent.keyCode===13){var off=this.$.input.getValue();r2ui.opendis(off)}},goRename:function(){var msg=prompt("New name?","");if(msg)r2.cmd("afr "+msg,function(){r2ui.seek("$$",true)})},goComment:function(){var msg=prompt("Comment?","");if(msg)r2.cmd("CC "+msg,function(){r2ui.seek("$$",true)})},goFlag:function(){var msg=prompt("Flag name?","");if(msg)r2.cmd("f "+msg,function(){r2ui.seek("$$",true)})},goUnflag:function(){r2.cmd("f-$$",function(){r2ui.seek("$$",true)})},goAnalyze:function(){r2.cmd("af",function(){r2ui.seek("$$",true)})},goCopy:function(){var msg=prompt("How many bytes?","");if(msg)r2.cmd("y "+msg,function(){r2ui.seek("$$",true)})},goPaste:function(){r2.cmd("yy",function(){r2ui.seek("$$",true)})},wrString:function(){var msg=prompt("Text","");if(msg)r2.cmd("w "+msg,function(){r2ui.seek("$$",true)})},wrOpcode:function(){var msg=prompt("Opcode","");if(msg)r2.cmd("wa "+msg,function(){r2ui.seek("$$",true)})},wrFile:function(){var msg=prompt("Filename","");if(msg)r2.cmd("wf "+msg,function(){r2ui.seek("$$",true)})},wrHex:function(){var msg=prompt("Hexpair","");if(msg)r2.cmd("wx "+msg,function(){r2ui.seek("$$",true)})},coCode:function(){var msg=prompt("How many bytes?","");if(msg)r2.cmd("y "+msg,function(){r2ui.seek("$$",true)})},coString:function(){r2.cmd("Cz",function(){r2ui.seek("$$",true)})},coData:function(){var msg=prompt("How many bytes?","");if(msg)r2.cmd("Cd "+msg,function(){r2ui.seek("$$",true)})},setTitle:function(title){if(title){this.$.title.setContent(title);this.$.title.setStyle("visibility:visible;top:8px");this.$.extra.setStyle("visibility:hidden;")}else{this.$.title.setStyle("visibility:hidden");this.$.extra.setStyle("visibility:visible;")}},components:[{kind:"onyx.Toolbar",components:[{kind:"onyx.Button",content:"[",ontap:"openSidebar",classes:"top"},{kind:"onyx.Button",content:"]",ontap:"openSidebar2",classes:"top"},{name:"title",tag:"h2",content:"Assembler",classes:"topbox",style:"visibility:hidden;"},{name:"extra",tag:"div",classes:"topbox",components:[{kind:"onyx.PickerDecorator",classes:"top",components:[{kind:"onyx.Button",content:"Actions"},{kind:"onyx.Picker",components:[{content:"Analyze",ontap:"goAnalyze"},{content:"Rename",ontap:"goRename"},{content:"Comment",ontap:"goComment"},{content:"Flag",ontap:"goFlag"},{content:"Unflag",ontap:"goUnflag"},{content:"Copy",ontap:"goCopy"},{content:"Paste",ontap:"goPaste"}]}]},{kind:"onyx.Button",content:"<",ontap:"prevSeek",classes:"top",style:"top:10px"},{kind:"onyx.Button",content:">",ontap:"nextSeek",classes:"top",style:"top:10px"},{kind:"onyx.InputDecorator",style:"width: 200px;top:10px",classes:"top",components:[{kind:"onyx.Input",name:"input",value:"entry0",onchange:"gotoSeek",onkeydown:"inputKey"}]},{kind:"onyx.PickerDecorator",classes:"top",components:[{kind:"onyx.Button",content:"Convert"},{kind:"onyx.Picker",components:[{content:"Data",ontap:"coData"},{content:"Code",ontap:"coCode"},{content:"String",ontap:"coString"}]}]},{kind:"onyx.PickerDecorator",classes:"top",components:[{kind:"onyx.Button",content:"Write"},{kind:"onyx.Picker",components:[{content:"File",ontap:"wrFile"},{content:"Hexpair",ontap:"wrHex"},{content:"String",ontap:"wrString"},{content:"Opcode",ontap:"wrOpcode"}]}]}]}]},{kind:"Panels",name:"panels",fit:true,draggable:false,realtimeFit:true,components:[{kind:"Disassembler",name:"pageDisassembler"},{kind:"Assembler",name:"pageAssembler"},{kind:"Hexdump",name:"pageHexdump"},{kind:"Graph",name:"pageGraph"},{kind:"Search",name:"pageSearch"},{kind:"Console",name:"pageConsole"},{kind:"Logs",name:"pageLogs"},{kind:"Script",name:"pageScript"},{kind:"Settings",name:"pageSettings"},{kind:"About",name:"pageAbout"}]}],create:function(){this.inherited(arguments);r2ui.panels=this.$.panels;this.$.panels.setIndex(0)},ra:null,openSidebar:function(){this.ra.setIndex(this.ra.index?0:1)},openSidebar2:function(){this.ra.setIndex(2)},rendered:function(){this.inherited(arguments)},openPage:function(idx){var str,sp=this.$.panels;var r=-1;switch(idx){case"Disassembler":r=0;break;case"Assembler":r=1;break;case"Hexdump":r=2;break;case"Graph":r=3;break;case"Search":r=4;break;case"Console":r=5;break;case"Logs":r=6;break;case"Script":r=7;break;case"Settings":r=8;break;case"About":r=9;break}if(r==-1){sp.setIndex(idx);return}eval("var x = this.$.page"+idx);switch(r){case 0:case 2:this.setTitle();break;default:this.setTitle(idx);break}sp.setIndex(r)},seekStack:[],nextSeek:function(){var addr=r2ui.history_next();if(!addr)return;r2ui.seek(addr,true)},prevSeek:function(){var addr=r2ui.history_prev();if(!addr)return;r2ui.seek(addr,true)},gotoSeek:function(){var addr=this.$.input.getValue();if(addr[0]=="!"){r2.cmd(addr.slice(1),function(x){alert(x)})}else{this.seekStack.push()}}});var r2={};var backward=false;var next_curoff=0;var next_lastoff=0;var prev_curoff=0;var prev_lastoff=0;r2.root="";function dump(obj){var x="";for(var a in obj)x+=a+"\n";alert(x)}function objtostr(obj){var str="";for(var a in obj)str+=a+": "+obj[a]+",\n";return str}function Ajax(method,uri,body,fn){var x=new XMLHttpRequest;x.open(method,uri,false);x.setRequestHeader("Accept","text/plain");x.setRequestHeader("Accept","text/html");x.setRequestHeader("Content-Type","application/x-ww-form-urlencoded; charset=UTF-8");x.onreadystatechange=function(y){if(x.status==200){if(fn)fn(x.responseText)}else console.error("ajax "+x.status)};x.send(body)}r2.assemble=function(offset,opcode,fn){var off=offset?"@"+offset:"";r2.cmd('"pa '+opcode+'"'+off,fn)};r2.disassemble=function(offset,bytes,fn){var off=offset?"@"+offset:"";var str="pi @b:"+bytes+off;r2.cmd(str,fn)};r2.get_hexdump=function(offset,length,cb){r2.cmd("px "+length+"@"+offset,cb)};r2.get_disasm=function(offset,length,cb){r2.cmd("pD "+length+"@"+offset,cb)};r2.config_set=function(fn){};r2.config_get=function(fn){};r2.set_flag_space=function(ns,fn){r2.cmd("fs "+ns,fn)};r2.set_flag_space=function(ns,fn){r2.cmd("fs "+ns,fn)};r2.get_flags=function(fn){r2.cmd("fj",function(x){fn(x?JSON.parse(x):[])})};r2.get_opcodes=function(off,n,cb){r2.cmd("pdj @"+off+"!"+n,function(json){cb(JSON.parse(json))})};r2.get_bytes=function(off,n,cb){r2.cmd("pcj @"+off+"!"+n,function(json){cb(JSON.parse(json))})};r2.get_info=function(cb){r2.cmd("ij",function(json){cb(JSON.parse(json))})};r2.bin_imports=function(cb){r2.cmd("iij",function(json){cb(JSON.parse(json))})};r2.bin_symbols=function(cb){r2.cmd("isj",function(json){cb(JSON.parse(json))})};r2.bin_sections=function(cb){r2.cmd("iSj",function(json){cb(JSON.parse(json))})};r2.cmds=function(cmds,cb){if(cmds.length==0)return;var cmd=cmds[0];cmds=cmds.splice(1);function lala(){if(cmd==undefined||cmds.length==0){return}cmd=cmds[0];cmds=cmds.splice(1);r2.cmd(cmd,lala);if(cb)cb();return}r2.cmd(cmd,lala)};r2.cmd=function(c,cb){Ajax("GET",r2.root+"/cmd/"+encodeURI(c),"",function(x){if(cb)cb(x)})};r2.alive=function(cb){r2.cmd("b",function(o){var ret=false;if(o&&o.length()>0)ret=true;if(cb)cb(o)})};r2.get_logger=function(obj){if(typeof obj!="object")obj={};obj.last=0;obj.events={};obj.interval=null;r2.cmd("ll",function(x){obj.last=+x});obj.load=function(cb){r2.cmd("lj "+(obj.last+1),function(ret){if(cb)cb(JSON.parse(ret))})};obj.clear=function(cb){r2.cmd("l-",cb)};obj.send=function(msg,cb){r2.cmd("l "+msg,cb)};obj.refresh=function(cb){obj.load(function(ret){for(var i=0;i<ret.length;i++){var message=ret[i];obj.events["message"]({id:message[0],text:message[1]});if(message[0]>obj.last)obj.last=message[0]}if(cb)cb()})};obj.autorefresh=function(n){if(!n){if(obj.interval)obj.interval.stop();return}function to(){obj.refresh(function(){});setTimeout(to,n*1e3);return true}obj.interval=setTimeout(to,n*1e3)};obj.on=function(ev,cb){obj.events[ev]=cb;return obj};return obj};r2.filter_asm=function(x,display){var curoff=backward?prev_curoff:next_curoff;var lastoff=backward?prev_lastoff:next_lastoff;var lines=x.split(/\n/g);r2.cmd("s",function(x){curoff=x});for(var i=lines.length-1;i>0;i--){var a=lines[i].match(/0x([a-fA-F0-9]+)/);if(a&&a.length>0){lastoff=a[0].replace(/:/g,"");break}}if(display=="afl"){var z="";for(var i=0;i<lines.length;i++){var row=lines[i].replace(/\ +/g," ").split(/ /g);z+=row[0]+"  "+row[3]+"\n"}x=z}else if(display[0]=="f"){if(display[1]=="s"){var z="";for(var i=0;i<lines.length;i++){var row=lines[i].replace(/\ +/g," ").split(/ /g);var mark=row[1]=="*"?"*":" ";var space=row[2]?row[2]:row[1];if(!space)continue;z+=row[0]+" "+mark+" <a href=\"javascript:runcmd('fs "+space+"')\">"+space+"</a>\n"}x=z}else{}}else if(display[0]=="i"){if(display[1]){var z="";for(var i=0;i<lines.length;i++){var elems=lines[i].split(/ /g);var name="";var addr="";for(var j=0;j<elems.length;j++){var kv=elems[j].split(/=/);if(kv[0]=="addr")addr=kv[1];if(kv[0]=="name")name=kv[1];if(kv[0]=="string")name=kv[1]}z+=addr+"  "+name+"\n"}x=z}}function haveDisasm(x){if(x[0]=="p"&&x[1]=="d")return true;if(x.indexOf(";pd")!=-1)return true;return false}if(haveDisasm(display)){x=x.replace(/function:/g,"<span style=color:green>function:</span>");x=x.replace(/;(\s+)/g,";");x=x.replace(/;(.*)/g,"// <span style='color:#209020'>$1</span>");x=x.replace(/(bl|goto|call)/g,"<b style='color:green'>call</b>");x=x.replace(/(jmp|bne|beq|js|jnz|jae|jge|jbe|jg|je|jl|jz|jb|ja|jne)/g,"<b style='color:green'>$1</b>");x=x.replace(/(dword|qword|word|byte|movzx|movsxd|cmovz|mov\ |lea\ )/g,"<b style='color:#1070d0'>$1</b>");x=x.replace(/(hlt|leave|iretd|retn|ret)/g,"<b style='color:red'>$1</b>");x=x.replace(/(add|sbb|sub|mul|div|shl|shr|and|not|xor|inc|dec|sar|sal)/g,"<b style='color:#d06010'>$1</b>");x=x.replace(/(push|pop)/g,"<b style='color:#40a010'>$1</b>");x=x.replace(/(test|cmp)/g,"<b style='color:#c04080'>$1</b>");x=x.replace(/(outsd|out|string|invalid|int |int3|trap|main|in)/g,"<b style='color:red'>$1</b>");x=x.replace(/nop/g,"<b style='color:blue'>nop</b>");x=x.replace(/(sym|fcn|str|imp|loc).([^:<(\\\/ \|)\->]+)/g,"<a href='javascript:r2ui.seek(\"$1.$2\")'>$1.$2</a>")}x=x.replace(/0x([a-zA-Z0-9]+)/g,"<a href='javascript:r2ui.seek(\"0x$1\")'>0x$1</a>");if(backward){prev_curoff=curoff;prev_lastoff=lastoff}else{next_curoff=curoff;next_lastoff=lastoff;if(!prev_curoff)prev_curoff=next_curoff}return x};var r2ui={};r2ui.history=[];r2ui.history_idx=0;r2ui.history_push=function(x){if(r2ui.history_idx!=r2ui.history.length)r2ui.history=r2ui.history.splice(0,r2ui.history_idx);r2ui.history_idx++;r2ui.history.push(x)};r2ui.history_pop=function(){if(r2ui.history_idx==r2ui.history.length)r2ui.history_idx--;return r2ui.history.pop()};r2ui.history_prev=function(){if(r2ui.history_idx>1)r2ui.history_idx--;var ret=r2ui.history[r2ui.history_idx-1];return ret};r2ui.history_next=function(){var ret=r2ui.history[r2ui.history_idx];if(r2ui.history_idx<r2ui.history.length)r2ui.history_idx++;return ret};r2ui.seek=function(addr,x){r2ui.history_push(addr);if(r2ui.ra.getIndex()==2)r2ui.ra.setIndex(1);r2.cmd("s "+addr,function(){r2ui._dis.seek(addr);r2ui._dis.scrollTo(0,0);r2ui._hex.seek(addr);r2ui._hex.scrollTo(0,0)})};r2ui.seek_prev=function(){var addr=r2ui.history.pop();r2.cmd("s "+addr,function(){r2ui._dis.seek(addr);r2ui._dis.scrollTo(0,0);r2ui._hex.seek(addr);r2ui._hex.scrollTo(0,0)})};r2ui.openpage=function(addr,idx){if(idx===undefined){idx=addr;addr=undefined}else if(addr!==undefined)r2ui.seek(addr);if(r2ui.ra.getIndex()==2)r2ui.ra.setIndex(1);r2ui.mp.openPage(idx)};r2ui.opendis=function(addr){r2ui.openpage(addr,0)};r2ui.openhex=function(addr){r2ui.openpage(addr,2)};function makelist(x){var z="List of "+x.length+"\n\n";for(var i=0;i<x.length;i++)z+="<a style='color:yellow' href='javascript:r2ui.opendis("+x[i].offset+")'>0x"+x[i].offset.toString(16)+"</a>  "+x[i].name+"\n";return z}enyo.kind({name:"RightPanel",style:"background-color:#404040;",classes:"onyx-toolbar",kind:"FittableRows",ra:null,components:[{kind:"FittableColumns",style:"margin-bottom:5px",components:[{kind:"onyx.Button",content:"[",ontap:"closeSidebar",style:"padding:8px;margin-right:8px"},{onup:"toggleScroll",style:"position:absolute;left:40px;top:0px;",kind:"onyx.MenuDecorator",onSelect:"itemSelected",components:[{content:"List elements"},{kind:"onyx.Menu",showOnTop:true,maxHeight:290,name:"menu",style:"height:300px",components:[{content:"flags",value:"2"},{content:"flagspaces",value:"2"},{classes:"onyx-menu-divider"},{content:"strings",value:"1"},{content:"symbols",value:"1"},{content:"imports",value:"1"},{content:"functions",value:"1"},{content:"comments",value:"1"},{classes:"onyx-menu-divider"},{content:"registers",value:"1"},{content:"stack",value:"2"},{content:"backtrace",value:"3"}]}]}]},{kind:"Scroller",animated:false,fit:true,horizontal:false,name:"scroll",components:[{tag:"pre",style:"font-size:14px",allowHtml:true,name:"output",content:".."}]}],toggleScroll:function(){var is_visible=this.$.menu.getShowing();this.$.scroll.setShowing(is_visible)},rowTap:function(){},create:function(){this.inherited(arguments)},data:[],setupItem:function(inSender,inIndex){var item=this.data[inIndex.index];if(!item)return false;var msg=item.name+" "+item.offset;console.log(msg);this.$.msg.setContent(msg);return true},refresh:function(){},itemSelected:function(inSender,inEvent){var self=this;var selected=inEvent.originator.content;var is_visible=this.$.menu.getShowing();r2ui.rp=self;this.$.scroll.setShowing(!!!is_visible);this.$.menu.setShowing(false);this.$.scroll.scrollToTop();switch(selected){case"comments":r2.cmd("CC*",function(x){x=x.replace(/0x([a-zA-Z0-9]*)/g,"<a style='color:yellow' href='javascript:r2ui.seek(\"0x$1\")'>0x$1</a>");self.$.output.setContent(x)});break;case"functions":r2.cmd("afl",function(x){x=x.replace(/0x([a-zA-Z0-9]*)/g,"<a style='color:yellow' href='javascript:r2ui.seek(\"0x$1\")'>0x$1</a>");self.$.output.setContent(x)});break;case"flagspaces":this.updateFlagspace();break;case"strings":r2.cmd("izj",function(x){var s=JSON.parse(x);var h="";for(var i in s){var off=(+s[i]["offset"]).toString(16);h+='<a style="color:yellow" href="javascript:r2ui.opendis(0x'+off+')">0x'+off+"</a> "+s[i]["string"]+"<br />"}self.$.output.setContent(h)});break;case"sections":r2.bin_sections(function(x){self.$.output.setContent(makelist(x))});break;case"symbols":r2.bin_symbols(function(x){self.$.output.setContent(makelist(x))});break;case"imports":r2.bin_imports(function(x){self.$.output.setContent(makelist(x))});break;case"flags":r2.get_flags(function(flags){self.data=flags;self.$.output.setContent(makelist(flags));self.refresh()});break}},closeSidebar:function(){this.ra.setIndex(1)},selectFlagspace:function(x){r2.cmd("fs "+x,function(x){r2ui.rp.updateFlagspace()})},updateFlagspace:function(){var self=r2ui.rp;r2.cmd("fsj",function(x){var s=JSON.parse(x);var h="";for(var i in s){var nam=s[i].name;var sel=s[i].selected;h+='<a style="color:yellow" href="javascript:r2ui.rp.selectFlagspace(\''+nam+"')\">"+nam+"</a> "+(sel?"  (selected)":"")+"<br />"}self.$.output.setContent(h)})}});enyo.kind({name:"Script",kind:"Scroller",style:"background-color:#c0c0c0",clear:function(){with(this.$.input){setContent(value="");render()}},demo:function(){with(this.$.input){setContent(value=['r2.disassemble (0, "9090", function(text) {',"  show (text)","  show ()",'  r2.assemble (0, "mov eax, 33", function (text) {',"    show (text);","  });","  show (r2)","});"].join("\n"));render()}},run:function(){var code=this.$.input.value;var out="";function show(x){if(!x)out+="\n";else if(typeof x=="object"){out+="{";for(var y in x){var v=x[y];out+=y+": "+v+"\n , "}out+="}"}else{out+=x+"\n"}}try{eval(code);this.$.output.setContent(out)}catch(e){alert(e)}},components:[{tag:"p",style:"margin-left:10px",components:[{kind:"onyx.Button",content:"Run",classes:"sourcebutton",ontap:"run"},{kind:"onyx.Button",content:"Clear",classes:"sourcebutton",ontap:"clear"},{kind:"onyx.Button",content:"Demo",classes:"sourcebutton",ontap:"demo"}]},{kind:"onyx.TextArea",name:"input",classes:"sourcecode"},{tag:"pre",name:"output",style:"margin-left:12px"}]});enyo.kind({name:"Search",kind:"Scroller",style:"background-color:#303030",components:[{tag:"center",components:[{tag:"h1",style:"color:#f0f0f0",content:"TODO: Search"}]}]});enyo.kind({name:"Settings",classes:"panels-sample-sliding-content r2panel",kind:"Scroller",tag:"div",style:"color:black !important;padding:0px;margin:0px;border:0px;overflow:hidden",components:[{kind:"FittableRows",fit:false,components:[{tag:"h2",content:"General"},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Two panels",classes:"rowline"},{kind:"onyx.ToggleButton",name:"twopanels"}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Edit keybindings",classes:"rowline"},{kind:"onyx.Button",content:"+"}]}]},{kind:"FittableRows",fit:false,components:[{tag:"h2",content:"Target"},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Arch",classes:"rowline"},{kind:"onyx.PickerDecorator",components:[{},{kind:"onyx.Picker",name:"arch",components:[{content:"arc"},{content:"arm"},{content:"avr"},{content:"ppc"},{content:"bf"},{content:"dalvik"},{content:"dcpu16"},{content:"i8080"},{content:"java"},{content:"m68k"},{content:"mips"},{content:"msil"},{content:"rar"},{content:"sh"},{content:"sparc"},{content:"x86",active:true},{content:"z80"}]}]}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Bits",classes:"rowline"},{kind:"onyx.PickerDecorator",components:[{},{kind:"onyx.Picker",name:"bits",components:[{content:"8"},{content:"16"},{content:"32",active:true},{content:"64"}]}]}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Endian",classes:"rowline"},{kind:"onyx.PickerDecorator",components:[{},{kind:"onyx.Picker",components:[{content:"little",active:true},{content:"big"}]}]}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"OS",classes:"rowline"},{kind:"onyx.PickerDecorator",components:[{},{kind:"onyx.Picker",components:[{content:"linux",active:true},{content:"darwin"},{content:"w32"},{content:"dos"}]}]}]},{tag:"h2",content:"Disassembly"},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Show bytes",classes:"rowline",ontap:"nextPanel"},{kind:"onyx.ToggleButton",name:"toggle_bytes"}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Show offsets",classes:"rowline",ontap:"nextPanel"},{kind:"onyx.ToggleButton",name:"toggle_offset"}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Show lines",classes:"rowline",ontap:"nextPanel"},{kind:"onyx.ToggleButton",name:"toggle_lines"}]},{kind:"onyx.InputDecorator",components:[{tag:"p",content:"Pseudo",classes:"rowline",ontap:"nextPanel"},{kind:"onyx.ToggleButton",name:"toggle_pseudo"}]}]},{tag:"h2",content:"Save changes?"},{tag:"div",style:"margin-left:50px",components:[{ontap:"reset",kind:"onyx.Button",style:"position:relative;left:0px",content:"Reset"},{ontap:"save",kind:"onyx.Button",style:"position:relative;left:50px",content:"Save",classes:"onyx-affirmative"}]},{tag:"div",style:"height:64px"}],load:function(){var self=this;
self.$.twopanels.setActive(document.referrer.indexOf("/two")!=-1);r2.cmd("e asm.bytes",function(x){self.$.toggle_bytes.setActive(x[0]=="t")});r2.cmd("e asm.pseudo",function(x){self.$.toggle_pseudo.setActive(x[0]=="t")});r2.cmd("e asm.offset",function(x){self.$.toggle_offset.setActive(x[0]=="t")})},create:function(){this.inherited(arguments);this.load()},save:function(){var arch=this.$.arch.selected.content;var bits=this.$.bits.selected.content;var show_bytes=this.$.toggle_bytes.active;var show_pseudo=this.$.toggle_pseudo.active;var show_offset=this.$.toggle_offset.active;var twopanels=this.$.twopanels.active;r2.cmds(["e asm.arch="+arch,"e asm.bits="+bits,"e asm.bytes="+show_bytes,"e asm.offset="+show_offset,"e asm.pseudo="+show_pseudo]);if(twopanels){window.parent.location="/enyo/two"}else{window.parent.location="/enyo/"}r2ui.seek("$$",true)},reset:function(){this.load()}});