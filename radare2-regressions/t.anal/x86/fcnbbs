#!/bin/sh
for a in . .. ../.. ; do [ -e $a/tests.sh ] && . $a/tests.sh ; done

FILE=../../bins/pe/bcc1.ex
CMDS='e anal.recont=true
af
afb
afb @ 0x401012
afb @ 0x40dfd0
'
EXPECT='0x00401000 0x00401002 00:0000 2
0x00401012 0x00401059 00:0000 71
0x0040dfd0 0x0040e075 00:0000 165 j 0x0040e0af f 0x0040e075
0x0040e075 0x0040e094 00:0000 31 j 0x0040e0a8
0x0040e094 0x0040e0a8 00:0000 20 j 0x0040e0a8
0x0040e0a8 0x0040e0af 00:0000 7 j 0x0040e094 f 0x0040e0af
0x0040e0af 0x0040e0c4 00:0000 21 j 0x0040e12b f 0x0040e0c4
0x0040e0c4 0x0040e0cc 00:0000 8 j 0x0040e0cd
0x0040e0cc 0x0040e0cd 00:0000 1 j 0x0040e0cd
0x0040e0cd 0x0040e0d3 00:0000 6 j 0x0040e0cc f 0x0040e0d3
0x0040e0d3 0x0040e0d7 00:0000 4 j 0x0040e0cc f 0x0040e0d7
0x0040e0d7 0x0040e0dc 00:0000 5 j 0x0040e0e1 f 0x0040e0dc
0x0040e0dc 0x0040e0e1 00:0000 5 j 0x0040e0e6
0x0040e0e1 0x0040e0e5 00:0000 4 j 0x0040e0e6
0x0040e0e5 0x0040e0e6 00:0000 1 j 0x0040e0e6
0x0040e0e6 0x0040e0ec 00:0000 6 j 0x0040e0f4 f 0x0040e0ec
0x0040e0ec 0x0040e0f0 00:0000 4 j 0x0040e0f4 f 0x0040e0f0
0x0040e0f0 0x0040e0f4 00:0000 4 j 0x0040e0e5 f 0x0040e0f4
0x0040e0f4 0x0040e0f9 00:0000 5 j 0x0040e0fd f 0x0040e0f9
0x0040e0f9 0x0040e0fc 00:0000 3 j 0x0040e0fd
0x0040e0fc 0x0040e0fd 00:0000 1 j 0x0040e0fd
0x0040e0fd 0x0040e103 00:0000 6 j 0x0040e107 f 0x0040e103
0x0040e103 0x0040e107 00:0000 4 j 0x0040e0fc f 0x0040e107
0x0040e107 0x0040e10b 00:0000 4 j 0x0040e0fc f 0x0040e10b
0x0040e10b 0x0040e12b 00:0000 32 j 0x0040e14c
0x0040e12b 0x0040e14c 00:0000 33 j 0x0040e14c
0x0040e14c 0x0040e153 00:0000 7
'
run_test

NAME="afb twice"
FILE=../../bins/pe/bcc1.ex
CMDS='e anal.recont=true
e anal.hasnext=true
af @ 0x40dfd0
af;afb;afb @ 0x40dfd0
'
EXPECT='0x00401000 0x00401002 00:0000 2 j 0x00401012
0x00401012 0x00401059 00:0000 71 j 0x0040dfd0
0x0040dfd0 0x0040e075 00:0000 165 j 0x0040e0af f 0x0040e075
0x0040e075 0x0040e094 00:0000 31 j 0x0040e0a8
0x0040e094 0x0040e0a8 00:0000 20 j 0x0040e0a8
0x0040e0a8 0x0040e0af 00:0000 7 j 0x0040e094 f 0x0040e0af
0x0040e0af 0x0040e0c4 00:0000 21 j 0x0040e12b f 0x0040e0c4
0x0040e0c4 0x0040e0cc 00:0000 8 j 0x0040e0cd
0x0040e0cc 0x0040e0cd 00:0000 1 j 0x0040e0cd
0x0040e0cd 0x0040e0d3 00:0000 6 j 0x0040e0cc f 0x0040e0d3
0x0040e0d3 0x0040e0d7 00:0000 4 j 0x0040e0cc f 0x0040e0d7
0x0040e0d7 0x0040e0dc 00:0000 5 j 0x0040e0e1 f 0x0040e0dc
0x0040e0dc 0x0040e0e1 00:0000 5 j 0x0040e0e6
0x0040e0e1 0x0040e0e5 00:0000 4 j 0x0040e0e6
0x0040e0e5 0x0040e0e6 00:0000 1 j 0x0040e0e6
0x0040e0e6 0x0040e0ec 00:0000 6 j 0x0040e0f4 f 0x0040e0ec
0x0040e0ec 0x0040e0f0 00:0000 4 j 0x0040e0f4 f 0x0040e0f0
0x0040e0f0 0x0040e0f4 00:0000 4 j 0x0040e0e5 f 0x0040e0f4
0x0040e0f4 0x0040e0f9 00:0000 5 j 0x0040e0fd f 0x0040e0f9
0x0040e0f9 0x0040e0fc 00:0000 3 j 0x0040e0fd
0x0040e0fc 0x0040e0fd 00:0000 1 j 0x0040e0fd
0x0040e0fd 0x0040e103 00:0000 6 j 0x0040e107 f 0x0040e103
0x0040e103 0x0040e107 00:0000 4 j 0x0040e0fc f 0x0040e107
0x0040e107 0x0040e10b 00:0000 4 j 0x0040e0fc f 0x0040e10b
0x0040e10b 0x0040e12b 00:0000 32 j 0x0040e14c
0x0040e12b 0x0040e14c 00:0000 33 j 0x0040e14c
0x0040e14c 0x0040e153 00:0000 7
'
run_test

