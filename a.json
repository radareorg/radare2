{
  "prompt": "# Task: Integrate dynamic prefix resolution into RAnal function naming\n\n## Goal\nModify RAnal so that function names can be dynamically prefixed based on flags in the `prefix:` flagspace.\n\n## Requirements\n- Add a static helper:\n  ```c\n  static const char *r_anal_choose_fcnprefix(RAnal *anal, ut64 addr);\n  ```\n- Behavior:\n  - If `anal.prefix.dynamic` is false â†’ return `anal.prefix.default`.\n  - If `anal.prefix.dynamic` is true:\n    - Query RFlag for the closest flag in the `prefix:` flagspace using `r_flag_closest_in_space`.\n    - The flag must have a name starting with `anal.prefix.marker` (default `\"pfx.fcn.\"`).\n    - Extract the suffix after the marker and return `fcn.<suffix>`.\n    - If no valid flag is found, return `anal.prefix.default`.\n- Integration point:\n  - Replace all direct uses of `anal.fcnprefix` with calls to `r_anal_choose_fcnprefix()` when generating function names.\n- Memory handling:\n  - Use `r_strf` (thread-local buffer) or a small internal buffer strategy to build the dynamic prefix string.\n\n## Constraints\n- Keep changes minimal; avoid refactoring unrelated parts of RAnal.\n- Ensure backward compatibility: when dynamic prefixing is disabled, behavior must be identical to today.\n\n## Deliverables\n- Implementation of `r_anal_choose_fcnprefix`.\n- Integration into function auto-naming logic.\n- Ensure compilation passes with no regressions."
}
