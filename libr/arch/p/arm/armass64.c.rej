@@ -1126,11 +1134,18 @@
 		if (width == 'b') {
 			check_cond(n <= 0xfff);
 		} else if (width == 'h') {
-			check_cond (n <= 0x1ffe && !(n & 1))
+			check_cond (n <= 0x1ffe && !(n & 1));
 			n >>= 1;
-		} else { // w
+		} else {
+			// choose scaling based on destination register size: 32-bit -> scale 2 (4 bytes), 64-bit -> scale 3 (8 bytes)
+			int scale = (op->operands[0].reg_type & ARM_REG64) ? 3 : 2;
+			if (scale == 2) {
 				check_cond(n <= 0x3ffc && !(n & 3));
 				n >>= 2;
+			} else {
+				check_cond(n <= 0x7ff8 && !(n & 7));
+				n >>= 3;
+			}
 		}
 		data = k | (n & 0x3f) << 18 | (n & 0xfc0) << 2 | 1;
 		return data;
@@ -2159,7 +2174,7 @@
 	} else if (!strncmp(str, "strh", 4)) {
 		*op = lsop(&ops, 0x00000078, -1);
 	} else if (!strncmp(str, "ldr", 3)) {
-		*op = reglsop (&ops, 0x000040f8);
+		*op = lsop (&ops, 0x000040f8, -1);
 	} else if (!strncmp(str, "stur", 4)) {
 		*op = regsluop(&ops, 0x000000f8);
 	} else if (!strncmp(str, "ldur", 4)) {
