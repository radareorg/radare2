NAME=num vars blocksize
FILE=malloc://0x4000
CMDS=<<EOF
b
?vi $b
b 32
?vi $b
?e must be zero
?vi $b-`b`
EOF
EXPECT=<<EOF
0x100
256
32
must be zero
0
EOF
RUN

NAME=num vars here
FILE=malloc://0x4000
CMDS=<<EOF
?vi $$
s 32
?vi $$
?vi $$ @ 64
?vi $$$ @ 64
EOF
EXPECT=<<EOF
0
32
64
32
EOF
RUN

NAME=num vars invalid
FILE=malloc://0x4000
ARGS=-1
CMDS=<<EOF
?vi $$rrr
EOF
EXPECT=<<EOF
ERROR: $$rrr
0
EOF
RUN

NAME=num vars keys
FILE=malloc://0x4000
ARGS=-1
CMDS=<<EOF
?e unknown foo key
?vi $k{foo}
?vi $k:foo
?e foo five
k foo=5
?vi $k{foo}
?vi $k:foo
?e plus one
?vi 1+$k{foo}
?vi 1+$k:foo
?e invalid $k
?vi $kaka
EOF
EXPECT=<<EOF
unknown foo key
ERROR: unknown $k{key}
0
ERROR: unknown $k{key}
0
foo five
5
5
plus one
6
6
invalid 0x0
ERROR: Expected '{' or ':' after 'k'
0
EOF
RUN

NAME=num vars keys error
FILE=malloc://0x4000
ARGS=-1
CMDS=<<EOF
k foo=5
?vi $k{foo}
?vi $k:foo
?e plus one
?vi $k{foo}+1
?vi $k:foo+1
EOF
EXPECT=<<EOF
5
5
plus one
6
6
EOF
RUN

NAME=num instruction vars
FILE=malloc://0x4000
ARGS=-1 -a x86 -b32
CMDS=<<EOF
'wa call 32;nop;mov eax,33;int 0x33;ret
?e jump call 32
?vi $ij
?e fail call 32
?vi $if
?e instr pos 1 2 3
?vi $in
?vi $in:1
?vi $in:2
?vi $in:3
?e instr size 1 2 3
?vi $is
?vi $is{-1}
?vi $is:1
?vi $is:2
?vi $is:3
2so
?e mov33
?vi $iv
EOF
EXPECT=<<EOF
INFO: Written 14 byte(s) (call 32;nop;mov eax,33;int 0x33;ret) = wx e81b00000090b821000000cd33c3 @ 0x00000000
jump call 32
32
fail call 32
5
instr pos 1 2 3
5
5
6
11
instr size 1 2 3
5
-1
5
6
11
mov33
33
EOF
RUN

NAME=num vars flags
FILE=bins/elf/analysis/arm-ls
CMDS=<<EOF
s main
?vi $f:main
?vi $fs:main
s+1
?vi $fd:main
?vi $fe{main}
EOF
EXPECT=<<EOF
73360
256
1
73616
EOF
RUN

NAME=num vars sections
FILE=bins/elf/analysis/arm-ls
CMDS=<<EOF
?v $S
?v $SS
?v $SE
?e distance
?v $SD
s+32
?v $SD
?e invalid name
?v $S{const}
?e byname
?v $S{rodata}
?v $SE{rodata}
s $S{rodata}
iS.
EOF
EXPECT=<<EOF
0x11e90
0x10728
0x225b8
distance
0x24b8
0x24d8
invalid name
0x0
byname
0x225c0
0x26ba0
Current section
nth paddr         size vaddr        vsize perm flags type     name
------------------------------------------------------------------
0   0x000125c0  0x45e0 0x000225c0  0x45e0 -r-- 0x2   PROGBITS .rodata
EOF
RUN

NAME=num vars fcn bbs
FILE=bins/elf/analysis/arm-ls
CMDS=<<EOF
s main
af
afl
?vi $Fs
?vi $FS
?vi $FE-$FB
?e bbs
?vi $BS
?vi $Bj
?vi $BF
EOF
EXPECT=<<EOF
0x00011e90  285   7152 main
0x0001cc8c    7    152 fcn.0001cc8c
0x00011da8    1     12 sym.imp.strrchr
0x00011e20    1     12 sym.imp.strncmp
0x00011b2c    1     12 sym.imp.fwrite
0x00011e2c    1     12 sym.imp.abort
0x00011d84    1     12 sym.imp.setlocale
0x00011dfc    1     12 sym.imp.bindtextdomain
0x00011ac0    1     12 sym.imp.textdomain
0x0002258c    1     36 fcn.0002258c
0x00011e14    1     12 sym.imp.isatty
0x00011be0    1     12 sym.imp.getenv
0x00019778   15    252 fcn.00019778
0x0001de7c    1     20 fcn.0001de7c
0x00011b38    1     12 sym.imp.ioctl
0x000207c0   64   1068 fcn.000207c0
0x00011c70    1     12 sym.imp.getopt_long
0x00011a78    1     12 sym.imp.dcgettext
0x00011964    1     12 sym.imp.fputs_unlocked
0x0001915c   21   1200 fcn.0001915c
0x00011d48    1     12 sym.imp.__fprintf_chk
0x00011c88    1     12 sym.imp.exit
0x00011d18    1     12 sym.imp.__printf_chk
0x00011994    1     12 sym.imp.strcmp
0x0001de30    1     48 fcn.0001de30
0x00011cdc    1     12 sym.imp.__errno_location
0x00020740    1     36 fcn.00020740
0x0002056c    3     88 fcn.0002056c
0x0001de64    1     20 fcn.0001de64
0x0001de94    1     56 fcn.0001de94
0x0001a40c    6     80 fcn.0001a40c
0x00014ad4    3    108 fcn.00014ad4
0x00014aa0    1     48 fcn.00014aa0
0x000119f4    1     12 sym.imp.free
0x000184cc  163   3216 fcn.000184cc
0x00015510    1     92 fcn.00015510
0x0001e2d4    4    168 fcn.0001e2d4
0x0001dc80   14    432 fcn.0001dc80
0x000205c4    3     76 fcn.000205c4
0x00011a9c    1     12 sym.imp.realloc
0x00020780    1     52 fcn.00020780
0x00011ba4    1     12 sym.imp.error
0x00011d00    1     12 sym.imp.memset
0x0001cfc8  135   2556 fcn.0001cfc8
0x00011a84    1     12 sym.imp.__stack_chk_fail
0x00011e50    1     12 sym.imp.closedir
0x00011bb0    1     12 sym.imp.opendir
0x00011de4    1     12 sym.imp.dirfd
0x00011afc    1     12 sym.imp.__fxstat64
0x0001b2dc    7     96 fcn.0001b2dc
0x0001b130   19    416 fcn.0001b130
0x0001a564   15    252 fcn.0001a564
0x0001a530    3     52 fcn.0001a530
0x0001a660    7    196 fcn.0001a660
0x0001afac   17    380 fcn.0001afac
0x00011bf8    1     12 sym.imp.malloc
0x00011a60    1     12 sym.imp._obstack_newchunk
0x00014f8c   54    912 fcn.00014f8c
0x0001df20    1    120 fcn.0001df20
0x00011b5c    1     12 sym.imp.__ctype_get_mb_cur_max
0x0001c8a0   40    476 fcn.0001c8a0
0x00011a48    1     12 sym.imp.fwrite_unlocked
0x00011c7c    1     12 sym.imp.__ctype_b_loc
0x00021548    5     44 fcn.00021548
0x000119c4    1     12 sym.imp.wcwidth
0x00011a30    1     12 sym.imp.mbsinit
0x00011dd8    1     12 sym.imp.readdir64
0x00011bbc    1     12 sym.imp.fnmatch
0x00015e80   12    208 fcn.00015e80
0x0001e118    1     20 fcn.0001e118
0x00021b68   79    508 fcn.00021b68
0x0001197c    1     12 sym.imp.raise
0x00011a90    1     12 sym.imp._obstack_begin
0x0001be90   24    428 fcn.0001be90
0x00020d94   66   1556 fcn.00020d94
0x00014470    1     28 fcn.00014470
0x00022170    3     60 fcn.00022170
0x0001ad04   12    272 fcn.0001ad04
0x0001a50c    1     20 fcn.0001a50c
0x00021d54    2     32 fcn.00021d54
0x0001a460   13    168 fcn.0001a460
0x00011958    1     12 sym.imp.calloc
0x00014b44   18    328 fcn.00014b44
0x00014d24   20    364 fcn.00014d24
0x000170b0   39   1128 fcn.000170b0
0x00011cb8    1     12 sym.imp.strlen
0x000149dc    7     96 fcn.000149dc
0x00011cac    1     12 sym.imp.tcgetpgrp
0x00011d90    1     12 sym.imp.sigemptyset
0x00011b14    1     12 sym.imp.sigaction
0x00011c04    1     12 sym.imp.sigaddset
0x00011a18    1     12 sym.imp.memcpy
0x00011aa8    1     12 sym.imp.sigismember
0x0001b470   96   2532 fcn.0001b470
0x00011e08    1     12 sym.imp.__xstat64
0x0001b340   11    296 fcn.0001b340
0x00015e34    3     68 fcn.00015e34
0x00015df4    3     60 fcn.00015df4
0x00011ad8    1     12 sym.imp.fflush_unlocked
0x00011a3c    1     12 sym.imp.signal
0x00015324    3    180 fcn.00015324
0x0001a8ac    1      8 fcn.0001a8ac
0x00011e80    1     12 sym.imp.__assert_fail
0x00011d78    1     12 sym.imp.__overflow
0x0001aed0   19    220 fcn.0001aed0
0x00011a54    1     12 sym.imp.memcmp
0x00020764    1     28 fcn.00020764
0x00014a44    5     88 fcn.00014a44
0x00011cc4    1     12 sym.imp.strchr
0x0001e424    1     20 fcn.0001e424
0x00011970    1     12 sym.imp.strstr
0x00011db4    1     12 sym.imp.nl_langinfo
0x0001c4a0   44    852 fcn.0001c4a0
0x00011c64    1     12 sym.imp.mempcpy
0x00011d9c    1     12 sym.imp.wcswidth
0x00011dcc    1     12 sym.imp.mbstowcs
0x00011ae4    1     12 sym.imp.iswprint
0x00011b98    1     12 sym.imp.wcstombs
0x000144ec   48    544 fcn.000144ec
0x00019874    1    108 fcn.00019874
0x0001e148    3     84 fcn.0001e148
0x0001ce2c    3     84 fcn.0001ce2c
0x0001e414    1     12 fcn.0001e414
9320
7152
9320
bbs
148
73508
73508
EOF
RUN
