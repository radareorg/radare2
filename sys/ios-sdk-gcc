#!/bin/sh

[ -z "${CPU}" ] && CPU="arm64"
CWD="$(dirname "$0")"
[ -z "${IOSINC}" ] && IOSINC="${CWD}/ios-include"
CPUS=""
CPU=`echo $CPU | sed -e 's,+, ,g'`
for a in `IFS=+ echo ${CPU}` ; do
	CPUS="-arch $a ${CPUS}"
done
[ -z "${SDK}" ] && SDK=iphoneos
APPLE_SDK=`echo ${SDK} |tr a-z A-Z`
# Respect EMBED_BITCODE; default off
BITCODE_FLAG=""
if [ "${EMBED_BITCODE}" = "1" ]; then
    BITCODE_FLAG="-fembed-bitcode"
fi
CC="xcrun --sdk ${SDK} clang ${CPUS} ${BITCODE_FLAG} -DAPPLE_SDK_${APPLE_SDK}=1 -I${IOSINC} -miphoneos-version-min=10.0"
echo $CC $*
${CC} $*
r=$?
[ "$r" != 0 ] && echo ${CC} $* >&2
exit $r
